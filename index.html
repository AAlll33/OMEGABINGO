<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMEGA Bingo - Compra y Consulta de Tablas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <style>
        /* ESTILOS BASE: Gradiente Morado y Animaciones */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(-45deg, #7e22ce, #a855f7, #6b21a8, #8b5cf6);
            background-size: 400% 400%;
            animation: gradient-flow 15s ease infinite;
            overflow-x: hidden;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bingo-card-image {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border: 4px solid #800080;
        }

        #footer-logo { max-width: 150px; height: auto; }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            20%, 80% { transform: rotate(-0.5deg); }
            40%, 60% { transform: rotate(0.5deg); }
        }
        .animate-wiggle { animation: wiggle 0.4s ease-in-out; }
        
        .copy-btn { cursor: pointer; transition: color 0.15s; }
        .copy-btn:hover { color: #d1d5db; }

        /* ESTILOS MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto; 
            padding: 20px 0;
        }
        .modal-content {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            width: 90%;
            max-width: 560px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* * ESTILOS DE BOTONES DE CART√ìN (MODIFICADOS) */
        .card-item-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .card-item-container:hover { transform: scale(1.05); }

        .bingo-ball {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: 900;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: background-color 0.1s, transform 0.1s;
        }
        
        .ver-tag {
            font-size: 11px;
            font-weight: bold;
            background-color: #fcd34d; /* Amarillo para 'Ver' */
            color: #1f2937;
            padding: 0 6px;
            margin-top: 4px;
            border-radius: 4px;
            border: 1px solid #fbbf24;
            user-select: none;
        }

        /* Colores de estado del cart√≥n (Morado OMEGA) */
        .status-available .bingo-ball {
            background-color: #6b21a8; /* Morado: Disponible */
            color: white;
            border: 2px solid #5b21b6;
        }
        .status-selected .bingo-ball {
            background-color: #fcd34d; /* Amarillo: Seleccionado (por el jugador actual, previo a reservar) */
            color: #1f2937; 
            border: 2px solid #fbbf24;
            transform: scale(1.08);
            box-shadow: 0 6px 10px rgba(0,0,0,0.4);
        }
        .status-reserved .bingo-ball {
            background-color: #f97316; /* NARANJA: Reservado por otro jugador (temporalmente) */
            color: white; 
            opacity: 0.9;
            border: 2px solid #ea580c;
        }
        .status-sold .bingo-ball {
            background-color: #ef4444; /* Rojo: Vendido (Permanente) */
            color: white;
            opacity: 0.8; 
            border: 2px solid #b91c1c;
        }
        
        /* ESTILOS PARA T√çTULOS OMEGA */
        .omega-title {
            font-family: 'Poppins', sans-serif; 
            font-weight: 900; 
            font-size: 3rem; 
            line-height: 1;
            text-shadow: 
                -2px -2px 0 #5b21b6, 
                 2px -2px 0 #5b21b6, 
                -2px  2px 0 #5b21b6, 
                 2px  2px 0 #5b21b6, 
                0px   4px 0 #5b21b6, 
                0px   8px 15px rgba(0,0,0,0.4); 
            color: #fcd34d; 
            display: inline-block; 
            animation: bounce-in 1s ease-out; 
        }

        .omega-subtitle {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #fca311; 
            text-shadow: 1px 1px 0 #a855f7;
        }

        @keyframes bounce-in {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        /* Estilos del Cron√≥metro */
        #countdownTimer {
            font-size: 2.5rem; 
            font-weight: 900; 
            color: #fcd34d; 
            text-shadow: 2px 2px 0 #5b21b6; 
            line-height: 1;
        }
        
        /* Estilos espec√≠ficos para el modal de previsualizaci√≥n (simulando Bingo Carabobo) */
        .card-preview-container {
            border: 5px solid #22c55e; /* Borde verde como en Bingo Carabobo */
            padding: 0.5rem;
            background-color: #166534; /* Fondo verde oscuro */
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
        }
        .card-preview-container img {
            border: 3px solid #fcd34d; /* Borde amarillo alrededor de la carta */
        }
        .card-preview-container .preview-title {
            color: #fcd34d; /* Amarillo para el t√≠tulo */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-xl mx-auto p-4 md:p-8">
        
        <div class="bg-yellow-400 p-4 rounded-t-xl text-center shadow-lg border-b-2 border-purple-800 mb-4">
            <p class="font-bold text-lg text-gray-900">
                ¬°DOMINGO <span id="bingoDate">16/11/25</span>!
            </p>
            <div class="mt-2 p-2 bg-purple-800 rounded-lg">
                <p class="text-white text-sm">Comienza en:</p>
                <div id="countdownTimer" class="text-4xl">--:--:--</div>
            </div>
        </div>
        
        <div class="bg-yellow-400 p-3 text-center shadow-lg border-b-2 border-purple-800">
            <p class="font-bold text-lg text-gray-900">
                Costo de la Tabla (4 Cartas): Bs. <span id="cardCost">300,00</span>
            </p>
        </div>
        
        <div class="bg-purple-800 p-4 rounded-b-xl text-center mb-8 shadow-lg">
            <p class="text-purple-100 text-sm">Tablas Disponibles:</p>
            <p class="text-4xl font-extrabold text-white" id="availableCount">75</p>
        </div>

        <header class="text-center mb-8">
            <h1 class="omega-title">OMEGA Bingo</h1>
            <p class="omega-subtitle mt-1">Elige tus n√∫meros de tabla y paga de forma sencilla.</p>
        </header>

        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border-t-4 border-purple-600">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                Datos para Pago M√≥vil
            </h2>
            
            <div class="space-y-3">
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-gray-600 font-semibold">Banco:</span>
                    <span id="bankInfo" class="text-gray-900 font-extrabold flex items-center">
                        0108 (Provincial BBVA)
                        <svg onclick="copyToClipboard('0108')" class="copy-btn w-4 h-4 ml-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3H6zm8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-gray-600 font-semibold">C√©dula:</span>
                    <span id="idInfo" class="text-gray-900 font-extrabold flex items-center">
                        V25822059
                        <svg onclick="copyToClipboard('V25822059')" class="copy-btn w-4 h-4 ml-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3H6zm8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-gray-600 font-semibold">Tel√©fono:</span>
                    <span id="phoneInfo" class="text-gray-900 font-extrabold flex items-center">
                        04129546751
                        <svg onclick="copyToClipboard('04129546751')" class="copy-btn w-4 h-4 ml-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3H6zm8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                </div>
            </div>
            <p class="text-sm text-gray-500 mt-4 text-center">Toca el √≠cono de al lado para copiar la informaci√≥n.</p>
        </div>

        <div class="mb-10 text-center">
             <button 
                onclick="showCardSelectionModal()" 
                class="w-full px-6 py-3 bg-yellow-400 text-gray-900 font-extrabold text-xl rounded-lg hover:bg-yellow-500 transition duration-150 shadow-xl active:scale-[0.98] uppercase"
            >
                Comprar Tablas
            </button>
        </div>

        <div class="text-center mb-4">
            <h2 class="text-xl font-bold text-white drop-shadow-md">Consulta tu Tabla Asignada</h2>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border-t-4 border-purple-600">
            <h3 class="text-lg font-bold text-gray-800 mb-3">Busca tu Tabla por Tel√©fono</h3>
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="tel" 
                    id="searchPhoneInput" 
                    placeholder="Tel√©fono del Jugador (Ej: 04121234567)"
                    class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 shadow-xl"
                >
                <button 
                    onclick="searchCardByPhone()" 
                    class="w-full sm:w-auto px-6 py-3 bg-yellow-400 text-gray-900 font-semibold rounded-lg hover:bg-yellow-500 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Consultar
                </button>
            </div>
        </div>

        <div id="phoneResultArea" class="hidden bg-white/95 backdrop-blur-sm p-6 rounded-xl shadow-2xl border-t-4 border-yellow-400 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                Tablas de <span id="assignedPlayerNamePhone" class="text-purple-600 font-extrabold"></span>
            </h2>
            <div id="phoneCardsList" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mt-4">
                </div>
             <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">Para descargar, usa la secci√≥n de "Ver Tabla Individual" m√°s abajo con el n√∫mero de tabla.</p>
            </div>
        </div>


        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border-t-4 border-purple-600">
            <h3 class="text-lg font-bold text-gray-800 mb-3">Ver Tabla Individual (¬°TODAS LAS TABLAS!)</h3>
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="number" 
                    id="cardNumberInput" 
                    placeholder="N√∫mero de Tabla (Ej: 23)"
                    class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 shadow-xl"
                >
                <button 
                    onclick="searchCard()" 
                    class="w-full sm:w-auto px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Ver Tabla
                </button>
            </div>
        </div>

        <div id="messageArea" class="text-center p-4 mb-4 text-sm text-red-700 bg-red-100 border border-purple-400 rounded-lg hidden">
        </div>

        <div id="resultArea" class="hidden bg-white/95 backdrop-blur-sm p-6 rounded-xl shadow-2xl border-t-4 border-purple-600">
            <h2 class="text-xl font-bold text-gray-800 mb-2">
                Tabla N¬∞ <span id="displayedCardNumber" class="text-purple-600"></span>
            </h2>
            <p class="text-gray-700 mb-4">
                Asignado al jugador: <span id="assignedPlayerName" class="font-extrabold text-purple-600 text-lg"></span>
            </p>
            
            <div id="bingoCardDisplay" class="flex justify-center mt-4">
            </div>

            <div class="mt-6 text-center">
                <a 
                    id="downloadLink" 
                    href="#" 
                    download="Tabla_Bingo.png"
                    class="inline-block px-8 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-150 shadow-lg active:scale-[0.98]"
                >
                    Descargar Tabla
                </a>
            </div>
        </div>

        <div class="mt-12 text-center text-purple-100">
             <div class="flex justify-center space-x-4 mb-4">
                <a href="https://facebook.com/OMEGABingo" target="_blank" class="text-2xl text-purple-200 hover:text-white transition duration-200"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/2021_Facebook_icon.svg/48px-2021_Facebook_icon.svg.png" alt="Facebook" class="w-8 h-8 rounded-full"></a>
                <a href="https://instagram.com/OMEGABingo" target="_blank" class="text-2xl text-purple-200 hover:text-white transition duration-200"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/48px-Instagram_icon.png" alt="Instagram" class="w-8 h-8 rounded-full"></a>
                <a href="https://tiktok.com/OMEGABingo" target="_blank" class="text-2xl text-purple-200 hover:text-white transition duration-200"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/TikTok_logo.svg/48px-TikTok_logo.svg.png" alt="TikTok" class="w-8 h-8 rounded-full"></a>
                <a href="https://wa.me/584226431972" target="_blank" class="text-2xl text-purple-200 hover:text-white transition duration-200"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/48px-WhatsApp.svg.png" alt="WhatsApp" class="w-8 h-8 rounded-full"></a>
            </div>
            
            <img 
                src="logo-omega-bingo.png" 
                alt="logo bingo omega" 
                class="mx-auto rounded-xl shadow-lg"
                id="footer-logo"
            >
            <p class="mt-4 text-sm drop-shadow-md">Para mas informacion consulta al Administrador Angel +584226431972</p>
            <p class="mt-2 text-xs text-purple-200 drop-shadow-md">¬© Copyright 2025 OMEGA Bingo. Todos los derechos reservados.</p>
        </div>
    </div>

    <div id="cardSelectionModal" class="modal" onclick="if(event.target.id === 'cardSelectionModal') hideCardSelectionModal()">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-2xl font-bold text-purple-800">Selecciona tus Tablas</h3>
                <button onclick="hideCardSelectionModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-semibold">&times;</button>
            </div>

            <div id="cardListContainer" class="max-h-80 overflow-y-auto p-2 grid grid-cols-6 gap-3 md:grid-cols-7 lg:grid-cols-8">
                </div>

            <div class="mt-6 text-center">
                <p class="text-lg font-bold">Total a Pagar: <span id="totalCostDisplay" class="text-green-600">Bs. 0,00</span></p>
                 <button 
                    onclick="preparePayment()" 
                    class="w-full mt-4 px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Continuar
                </button>
            </div>
        </div>
    </div>

    <div id="cardPreviewModal" class="modal" onclick="if(event.target.id === 'cardPreviewModal') hideCardPreviewModal()">
        <div class="modal-content !max-w-md">
            <div class="flex justify-between items-start mb-4 border-b pb-2">
                <h3 id="previewHeader" class="text-xl font-bold text-gray-800"></h3>
                <button onclick="hideCardPreviewModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-semibold">&times;</button>
            </div>

            <div class="card-preview-container p-3 text-center">
                <h4 class="preview-title font-extrabold text-2xl mb-3">Cart√≥n #<span id="previewCardNumber"></span></h4>
                <div id="previewCardImage" class="flex justify-center">
                    <img src="https://placehold.co/250x250/166534/fcd34d?text=TABLA%20PREVIEW" alt="Previsualizaci√≥n de Tabla" class="rounded-lg shadow-xl max-w-[250px] w-full"/>
                </div>
            </div>

            <div class="mt-6 text-center">
                <p class="text-sm font-semibold text-red-500 mb-3">Confirma si deseas elegir este cart√≥n</p>
                <div class="flex justify-center gap-4">
                    <button id="previewLoQuieroBtn" 
                        onclick="selectCardFromPreview()"
                        class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md active:scale-[0.98] flex items-center"
                    >
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        LO QUIERO
                    </button>
                    <button 
                        onclick="hideCardPreviewModal()"
                        class="px-6 py-2 bg-gray-400 text-gray-900 font-semibold rounded-lg hover:bg-gray-500 transition duration-150 shadow-md active:scale-[0.98] flex items-center"
                    >
                         <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        No lo quiero
                    </button>
                </div>
            </div>
            <div class="mt-4">
                 <button 
                    onclick="hideCardPreviewModal(); showCardSelectionModal();" 
                    class="w-full mt-2 px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Volver al Tablero
                </button>
            </div>
        </div>
    </div>


    <div id="paymentProcessModal" class="modal" onclick="if(event.target.id === 'paymentProcessModal') hidePaymentProcessModal()">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-2xl font-bold text-purple-800">Proceso de Compra</h3>
                <button onclick="hidePaymentProcessModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-semibold">&times;</button>
            </div>
            
            <p class="text-center font-bold text-sm text-gray-700 mb-4 bg-yellow-100 p-2 rounded flex items-center justify-center">
                <svg class="w-5 h-5 mr-1 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                Tienes <span id="paymentTimer" class="font-extrabold mx-1 text-red-600">05:00</span> para completar el pago.
            </p>

            <div class="space-y-4">
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-gray-600 font-semibold">Monto Exacto:</span>
                    <span id="paymentTotalCost" class="text-xl font-extrabold text-green-600">Bs. 0,00</span>
                </div>
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-gray-600 font-semibold">Banco Provincial (0108)</span>
                    <span class="text-md font-bold text-gray-900">04129546751 / V25822059</span>
                </div>
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-gray-600 font-semibold">Tablas N¬∞:</span>
                    <span id="paymentCardsList" class="text-md font-bold text-purple-600 text-right"></span>
                </div>
            </div>

            <div class="mt-4 space-y-3">
                <input 
                    type="text" 
                    id="payerName" 
                    placeholder="Nombre completo" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                    required
                >
                <input 
                    type="tel" 
                    id="payerPhone" 
                    placeholder="N√∫mero de WhatsApp (Ej: 04121234567)" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                    required
                >
                <input 
                    type="text" 
                    id="referenceDigits" 
                    placeholder="√öltimos 4 d√≠gitos de la referencia de Pago M√≥vil" 
                    maxlength="4"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                    required
                >
            </div>
             <p class="text-center text-sm text-gray-500 mt-2">Sube o confirma el comprobante de pago con el administrador por WhatsApp.</p>
            
            <div class="mt-6 pt-4 border-t text-center">
                 <button 
                    onclick="sendPurchaseToWhatsapp()" 
                    class="w-full px-6 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Reservar y Enviar Pago (WhatsApp)
                </button>
            </div>
        </div>
    </div>


    <script>
        // =========================================================================
        // üîë GESTI√ìN CENTRALIZADA DE VENTAS (¬°MODIFICAR S√ìLO ESTA SECCI√ìN!)
        // =========================================================================
        /**
         * Objeto principal para gestionar las ventas y asignaciones.
         * Clave: N√∫mero de Tabla (string)
         * Valor: { name: Nombre del Jugador, phone: Tel√©fono del Jugador, file: Nombre del Archivo de Imagen }
         */
        const CARD_SALES_DATA = {
            "1": { name: "Juan P√©rez", phone: "04129546751", file: "tabla_1.png" },
            
            
            
            
            
            
            
        };
        
        /**
         * Almacenamiento temporal para reservas (simula un backend o base de datos)
         * Clave: N√∫mero de Tabla (string)
         * Valor: { reservedBy: Tel√©fono del jugador, timestamp: Tiempo de reserva (ms) }
         */
        let RESERVATION_DATA = JSON.parse(localStorage.getItem('OMEGA_RESERVATIONS')) || {};
        const RESERVATION_DURATION_MS = 5 * 60 * 1000; // 5 minutos en milisegundos

        // =========================================================================
        // DATOS Y VARIABLES GLOBALES
        // =========================================================================
        const TOTAL_CARDS = 75; 
        const CARD_PRICE = 300.00; 
        let selectedCards = [];
        let cardToPreview = null; 
        const ADMIN_WHATSAPP = '584226431972'; 
        let paymentTimerInterval;
        
        // **FECHA DE BINGO FIJA** (El cron√≥metro correr√° continuo)
        const BINGO_START_TIME = 'November 16, 2025 20:00:00'; // 8:00 PM
        const BINGO_DATE = new Date(BINGO_START_TIME).getTime(); 

        // Datos de Pago M√≥vil actualizados
        const PAYMENT_DATA = {
            bank: '0108 (Provincial BBVA)',
            cedula: 'V25822059',
            phone: '04129546751',
        };
        document.getElementById('bankInfo').textContent = PAYMENT_DATA.bank.split('(')[0].trim() + ' (Provincial BBVA)'; // Mantener el c√≥digo
        document.getElementById('idInfo').textContent = PAYMENT_DATA.cedula;
        document.getElementById('phoneInfo').textContent = PAYMENT_DATA.phone;


        // =========================================================================
        // FUNCI√ìN DE UTILIDAD: MANEJO DE RESERVAS Y LOCAL STORAGE
        // =========================================================================

        function saveReservations() {
            // Solo se guarda el estado de reserva en el local storage
            localStorage.setItem('OMEGA_RESERVATIONS', JSON.stringify(RESERVATION_DATA));
        }

        function checkAndClearReservations() {
            const now = new Date().getTime();
            let changed = false;
            
            for (const tableNum in RESERVATION_DATA) {
                if (now - RESERVATION_DATA[tableNum].timestamp > RESERVATION_DURATION_MS) {
                    delete RESERVATION_DATA[tableNum];
                    changed = true;
                }
            }

            if (changed) {
                saveReservations();
                // Si la selecci√≥n modal est√° abierta, la regeneramos para reflejar el cambio
                if (document.getElementById('cardSelectionModal').style.display === 'flex') {
                    generateCardButtons();
                }
            }
        }
        
        // Ejecutar cada minuto para limpiar reservas expiradas
        setInterval(checkAndClearReservations, 60000); 

        // Inicializar el contador de disponibles al cargar la p√°gina
        function updateAvailableCount() {
            checkAndClearReservations(); // Limpiar antes de contar
            const soldCount = Object.keys(CARD_SALES_DATA).length;
            const availableCount = TOTAL_CARDS - soldCount;
            document.getElementById('availableCount').textContent = availableCount;
        }

        // =========================================================================
        // CRON√ìMETRO DE BINGO (CONTINUO)
        // =========================================================================
        function updateBingoCountdown() {
            const now = new Date().getTime();
            const distance = BINGO_DATE - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            let timerText;
            if (distance < 0) {
                clearInterval(bingoCountdownInterval);
                timerText = '¬°JUGANDO AHORA!';
            } else if (days > 0) {
                 timerText = `${days}D ${hours}H ${minutes}M`;
            } else {
                 timerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            document.getElementById('countdownTimer').textContent = timerText;
        }

        const bingoCountdownInterval = setInterval(updateBingoCountdown, 1000);


        // =========================================================================
        // FUNCIONES MODAL DE SELECCI√ìN (PASO 1)
        // =========================================================================

        function showCardSelectionModal() {
            // Asegurarse de que las reservas expiradas se limpien antes de mostrar
            checkAndClearReservations(); 
            updateTotalCostDisplay();
            document.getElementById('cardSelectionModal').style.display = 'flex';
            generateCardButtons();
        }

        function hideCardSelectionModal() {
            document.getElementById('cardSelectionModal').style.display = 'none';
        }

        function generateCardButtons() {
            const container = document.getElementById('cardListContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= TOTAL_CARDS; i++) {
                const tableNumStr = i.toString();
                const isSold = CARD_SALES_DATA[tableNumStr] !== undefined; 
                const isReserved = RESERVATION_DATA[tableNumStr] !== undefined;
                let statusClass = 'status-available';

                if (isSold) {
                    statusClass = 'status-sold';
                } else if (isReserved) {
                    statusClass = 'status-reserved';
                } else if (selectedCards.includes(i)) {
                    statusClass = 'status-selected';
                }

                const itemContainer = document.createElement('div');
                itemContainer.className = `card-item-container ${statusClass}`;
                itemContainer.dataset.cardNum = i;
                itemContainer.title = isSold ? `Tabla vendida a ${CARD_SALES_DATA[tableNumStr]?.name || 'Jugador Asignado'}` 
                                    : (isReserved ? 'Tabla reservada (5 min)' : `Tabla N¬∞ ${i}`);

                const ball = document.createElement('div');
                ball.className = 'bingo-ball';
                ball.textContent = i;
                
                const verTag = document.createElement('div');
                verTag.className = 'ver-tag';
                
                // Texto de la etiqueta
                if (isSold) {
                    verTag.textContent = 'VENDIDA';
                } else if (isReserved) {
                    verTag.textContent = 'RESERVA';
                } else if (selectedCards.includes(i)) {
                     verTag.textContent = 'OK'; 
                } else {
                     verTag.textContent = 'VER';
                }

                // Las tablas vendidas o reservadas no se pueden seleccionar, solo ver.
                if (isSold || isReserved) {
                    itemContainer.onclick = () => showCardPreviewModal(i);
                } else {
                    itemContainer.onclick = () => showCardPreviewModal(i);
                }
                
                itemContainer.appendChild(ball);
                itemContainer.appendChild(verTag);
                container.appendChild(itemContainer);
            }
        }

        function toggleCardSelection(cardNum, itemContainer) {
            const tableNumStr = cardNum.toString();
            const verTag = itemContainer ? itemContainer.querySelector('.ver-tag') : null;
            const index = selectedCards.indexOf(cardNum);
            
            // Si est√° vendida o reservada, no se puede seleccionar/desseleccionar
            if (CARD_SALES_DATA[tableNumStr] || RESERVATION_DATA[tableNumStr]) return;
            
            if (index > -1) {
                // Desseleccionar la tarjeta
                selectedCards.splice(index, 1);
                if (itemContainer) {
                    itemContainer.classList.remove('status-selected');
                    itemContainer.classList.add('status-available');
                }
                if (verTag) verTag.textContent = 'VER';

            } else {
                // Seleccionar la tarjeta
                selectedCards.push(cardNum);
                if (itemContainer) {
                    itemContainer.classList.add('status-selected');
                    itemContainer.classList.remove('status-available');
                }
                 if (verTag) verTag.textContent = 'OK';
            }
            selectedCards.sort((a, b) => a - b);
            updateTotalCostDisplay();
            
            // Actualizar el estado del bot√≥n "Lo Quiero" en el preview si est√° abierto
            if (document.getElementById('cardPreviewModal').style.display === 'flex' && cardToPreview === cardNum) {
                updatePreviewModalLoQuieroBtn(cardNum);
            }
        }

        function updateTotalCostDisplay() {
            const total = selectedCards.length * CARD_PRICE; 
            document.getElementById('totalCostDisplay').textContent = `Bs. ${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }
        
        // =========================================================================
        // FUNCIONES MODAL DE PREVIEW
        // =========================================================================
        
        function showCardPreviewModal(cardNumber) {
            cardToPreview = cardNumber;
            const tableNumStr = cardNumber.toString();
            const isSold = CARD_SALES_DATA[tableNumStr] !== undefined;
            const isReserved = RESERVATION_DATA[tableNumStr] !== undefined;

            // T√≠tulo/Encabezado
            const previewHeader = document.getElementById('previewHeader');
            previewHeader.innerHTML = `Cart√≥n N¬∞ ${cardNumber}`;

            // Actualizar la imagen del cart√≥n
            const fileName = `tabla_${cardNumber}.png`; 
            const filePath = `./tablas/${fileName}`; 
            const imgElement = document.getElementById('previewCardImage').querySelector('img');
            imgElement.src = filePath;
            imgElement.alt = `Tabla N¬∞ ${cardNumber}`;
            imgElement.onerror = function() {
                 this.src='https://placehold.co/250x250/166534/fcd34d?text=TABLA%20${cardNumber}';
            };

            // N√∫mero de Cart√≥n en el t√≠tulo verde
            document.getElementById('previewCardNumber').textContent = cardNumber;
            
            // Mostrar modal y actualizar bot√≥n
            document.getElementById('cardPreviewModal').style.display = 'flex';
            updatePreviewModalLoQuieroBtn(cardNumber);
        }

        function hideCardPreviewModal() {
            document.getElementById('cardPreviewModal').style.display = 'none';
            cardToPreview = null;
        }
        
        function updatePreviewModalLoQuieroBtn(cardNumber) {
            const loQuieroBtn = document.getElementById('previewLoQuieroBtn');
            const tableNumStr = cardNumber.toString();
            const isSold = CARD_SALES_DATA[tableNumStr] !== undefined;
            const isReserved = RESERVATION_DATA[tableNumStr] !== undefined;
            const isSelected = selectedCards.includes(cardNumber);

            if (isSold) {
                loQuieroBtn.textContent = 'VENDIDO';
                loQuieroBtn.disabled = true;
                loQuieroBtn.className = 'px-6 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md flex items-center opacity-70 cursor-not-allowed';
            } else if (isReserved) {
                loQuieroBtn.textContent = 'RESERVADO';
                loQuieroBtn.disabled = true;
                loQuieroBtn.className = 'px-6 py-2 bg-orange-600 text-white font-semibold rounded-lg shadow-md flex items-center opacity-70 cursor-not-allowed';
            } else if (isSelected) {
                loQuieroBtn.innerHTML = '<svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> DEJAR';
                loQuieroBtn.disabled = false;
                loQuieroBtn.className = 'px-6 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition duration-150 shadow-md active:scale-[0.98] flex items-center';
            } else {
                loQuieroBtn.innerHTML = '<svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> LO QUIERO';
                loQuieroBtn.disabled = false;
                loQuieroBtn.className = 'px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md active:scale-[0.98] flex items-center';
            }
        }
        
        function selectCardFromPreview() {
            if (cardToPreview === null) return;
            
            const itemContainer = document.querySelector(`.card-item-container[data-card-num="${cardToPreview}"]`);

            if (selectedCards.includes(cardToPreview)) {
                // Si ya est√° seleccionada, al darle "DEJAR" la desselecciona
                toggleCardSelection(cardToPreview, itemContainer);
            } else {
                // Si no est√° seleccionada, al darle "LO QUIERO" la selecciona
                 toggleCardSelection(cardToPreview, itemContainer);
            }
            
            // Re-generar los botones del tablero en el modal de selecci√≥n para actualizar el estado visual
            generateCardButtons(); 
            updatePreviewModalLoQuieroBtn(cardToPreview); 
        }


        // =========================================================================
        // FUNCIONES MODAL DE PAGO (PASO 3)
        // =========================================================================
        
        let paymentTimerEndByPhone = JSON.parse(localStorage.getItem('OMEGA_PAYMENT_TIMERS')) || {};
        const PAYMENT_TIMEOUT_MS = 5 * 60 * 1000; // 5 minutos

        function preparePayment() {
            if (selectedCards.length === 0) {
                alert('Por favor, selecciona al menos una Tabla para continuar.');
                return;
            }
            
            // PRIMER PASO DE RESERVA: Marcar las tablas seleccionadas como 'reserved'
            const now = new Date().getTime();
            selectedCards.forEach(cardNum => {
                const tableNumStr = cardNum.toString();
                // Solo reservar si no est√° vendida y no est√° ya reservada por otro
                if (!CARD_SALES_DATA[tableNumStr] && !RESERVATION_DATA[tableNumStr]) {
                     // El 'reservedBy' se establecer√° con el n√∫mero de tel√©fono cuando se abra el modal de pago
                    RESERVATION_DATA[tableNumStr] = { reservedBy: 'PENDING_PHONE', timestamp: now };
                }
            });
            saveReservations();
            
            hideCardSelectionModal();
            
            const total = selectedCards.length * CARD_PRICE;
            const tablesList = selectedCards.join(', ');
            const totalFormatted = total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            document.getElementById('paymentTotalCost').textContent = `Bs. ${totalFormatted}`;
            document.getElementById('paymentCardsList').textContent = tablesList;
            
            // Limpiar campos y activar cron√≥metro
            document.getElementById('payerName').value = '';
            // El campo de tel√©fono es clave, lo limpiaremos, pero su valor determinar√° el temporizador
            document.getElementById('payerPhone').value = ''; 
            document.getElementById('referenceDigits').value = '';

            document.getElementById('paymentProcessModal').style.display = 'flex';
            // El temporizador real se inicia cuando el jugador ingresa su tel√©fono
        }
        
        function hidePaymentProcessModal() {
            clearInterval(paymentTimerInterval); 
            document.getElementById('paymentProcessModal').style.display = 'none';
        }

        function startContinuousPaymentTimer(phoneNumber) {
            clearInterval(paymentTimerInterval);
            
            const now = new Date().getTime();
            let timerEnd;
            let storedEnd = paymentTimerEndByPhone[phoneNumber];

            // 1. Verificar si hay un temporizador previo asociado a este tel√©fono
            if (storedEnd && storedEnd > now) {
                timerEnd = storedEnd;
            } else {
                // 2. Si no hay o ya expir√≥, iniciar uno nuevo de 5 minutos
                timerEnd = now + PAYMENT_TIMEOUT_MS;
                paymentTimerEndByPhone[phoneNumber] = timerEnd;
                localStorage.setItem('OMEGA_PAYMENT_TIMERS', JSON.stringify(paymentTimerEndByPhone));
                
                // Actualizar la reserva en RESERVATION_DATA con el tel√©fono real si es la primera vez que se activa
                selectedCards.forEach(cardNum => {
                    const tableNumStr = cardNum.toString();
                    if (RESERVATION_DATA[tableNumStr] && RESERVATION_DATA[tableNumStr].reservedBy === 'PENDING_PHONE') {
                        RESERVATION_DATA[tableNumStr].reservedBy = phoneNumber;
                        RESERVATION_DATA[tableNumStr].timestamp = now;
                    }
                });
                saveReservations();
                generateCardButtons(); // Regenerar para reflejar el estado RESERVED
            }

            paymentTimerInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = timerEnd - now;

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                const timerElement = document.getElementById('paymentTimer');

                if (distance < 0) {
                    clearInterval(paymentTimerInterval);
                    timerElement.textContent = '¬°TIEMPO AGOTADO!';
                    // Simular liberaci√≥n de tablas (en un entorno real, el backend lo har√≠a)
                    selectedCards.forEach(cardNum => {
                        delete RESERVATION_DATA[cardNum.toString()];
                    });
                    saveReservations();
                    selectedCards = [];
                    // Opcional: Cerrar modal y mostrar alerta
                } else {
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        // Listener para iniciar el contador cuando el jugador ingresa su tel√©fono
        document.getElementById('payerPhone').addEventListener('blur', function() {
            const phone = this.value.trim().replace(/[^0-9]/g, '');
            if (phone.length >= 10) {
                startContinuousPaymentTimer(phone);
            }
        });


        function sendPurchaseToWhatsapp() {
            const payerName = document.getElementById('payerName').value.trim();
            const payerPhone = document.getElementById('payerPhone').value.trim().replace(/[^0-9]/g, ''); // Limpiar el tel√©fono
            const referenceDigits = document.getElementById('referenceDigits').value.trim();
            const totalAmount = selectedCards.length * CARD_PRICE;
            const tablesList = selectedCards.join(', ');

            if (!payerName || payerPhone.length < 10 || referenceDigits.length !== 4) {
                alert('Por favor, completa tu Nombre, tu Tel√©fono de WhatsApp (m√≠n. 10 d√≠gitos) y los 4 d√≠gitos de la referencia del pago m√≥vil.');
                return;
            }
            
            clearInterval(paymentTimerInterval);
            delete paymentTimerEndByPhone[payerPhone]; // El pago est√° listo, borramos el temporizador de pago.
            localStorage.setItem('OMEGA_PAYMENT_TIMERS', JSON.stringify(paymentTimerEndByPhone));

            // Eliminar la reserva de las tablas seleccionadas (se mover√°n a CARD_SALES_DATA por el admin)
            selectedCards.forEach(cardNum => {
                 delete RESERVATION_DATA[cardNum.toString()];
            });
            saveReservations();


            // Mensaje final para el administrador (tu n√∫mero)
            const whatsappMessage = encodeURIComponent(
                `üéâ ¬°PAGO Y RESERVA OMEGA BINGO! üéâ\n\n` +
                `*Tablas:* ${selectedCards.length} (${tablesList})\n` +
                `*Monto Pagado:* Bs. ${totalAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}\n` +
                `*Banco/C√©dula Pagador:* ${PAYMENT_DATA.bank.split('(')[0].trim()} / ${PAYMENT_DATA.cedula}\n` +
                `*Nombre del Pagador:* ${payerName}\n` +
                `*Tel√©fono del Pagador:* ${payerPhone}\n` +
                `*D√≠gitos de Referencia (Pago M√≥vil):* ${referenceDigits}\n\n` +
                `_¬°Revisa y asigna las Tablas en el archivo CARD_SALES_DATA!_`
            );
            
            const whatsappLink = `https://wa.me/${ADMIN_WHATSAPP}?text=${whatsappMessage}`;

            triggerConfetti();

            setTimeout(() => {
                hidePaymentProcessModal();
                selectedCards = []; 
                updateAvailableCount(); 
                window.open(whatsappLink, '_blank');
            }, 1000); 
        }


        // =========================================================================
        // FUNCI√ìN: CONSULTA POR TEL√âFONO y N√öMERO DE TABLA 
        // =========================================================================

        // (Las funciones searchCardByPhone y searchCard se mantienen igual, solo se actualiza el nombre de la variable de pago m√≥vil)

        function searchCardByPhone() {
            // ... (implementaci√≥n de searchCardByPhone) ...
            const phoneInput = document.getElementById('searchPhoneInput');
            const searchPhone = phoneInput.value.trim().replace(/[^0-9]/g, ''); 
            
            const phoneResultArea = document.getElementById('phoneResultArea');
            const phoneCardsList = document.getElementById('phoneCardsList');
            const assignedPlayerNamePhone = document.getElementById('assignedPlayerNamePhone');
            
            showMessage('', 'clear');
            phoneResultArea.classList.add('hidden');
            phoneCardsList.innerHTML = '';
            
            if (searchPhone.length < 10) {
                showMessage("Por favor, ingresa un n√∫mero de tel√©fono completo (m√≠n. 10 d√≠gitos).", 'red');
                return;
            }

            let foundCards = [];
            let playerName = '';

            for (const tableNum in CARD_SALES_DATA) {
                const sale = CARD_SALES_DATA[tableNum];
                const cleanSalePhone = sale.phone.replace(/[^0-9]/g, '');

                if (cleanSalePhone === searchPhone) {
                    foundCards.push({ table: tableNum, ...sale });
                    playerName = sale.name; 
                }
            }

            if (foundCards.length === 0) {
                showMessage(`El n√∫mero ${phoneInput.value} no tiene Tablas asignadas o no est√° registrado.`, 'yellow');
                return;
            }

            assignedPlayerNamePhone.textContent = playerName;
            
            foundCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'text-center p-2 border border-purple-300 rounded-lg shadow-md bg-white';
                
                cardDiv.innerHTML = `
                    <p class="font-bold text-lg text-purple-700">Tabla ${card.table}</p>
                    <img src="./tablas/${card.file}" alt="Tabla ${card.table}" class="bingo-card-image w-full h-auto rounded-md mt-2 mx-auto"
                        onerror="this.onerror=null; this.src='https://placehold.co/150x150/800080/FFFFFF?text=TABLA%20${card.table}';"
                    />
                `;
                phoneCardsList.appendChild(cardDiv);
            });

            phoneResultArea.classList.remove('hidden');
            showMessage(`¬°Se encontraron ${foundCards.length} Tablas asignadas a ${playerName}!`, 'green');
        }


        function searchCard() {
            // ... (implementaci√≥n de searchCard) ...
            const inputElement = document.getElementById('cardNumberInput');
            const rawCardNumber = inputElement.value.trim();
            const cardNumber = parseInt(rawCardNumber, 10).toString();

            showMessage('', 'clear'); 
            resultArea.classList.add('hidden');

            if (!rawCardNumber || isNaN(cardNumber) || parseInt(cardNumber) < 1 || parseInt(cardNumber) > TOTAL_CARDS) {
                showMessage("Por favor, ingresa un n√∫mero de Tabla v√°lido entre 1 y " + TOTAL_CARDS + ".", 'red');
                return;
            }

            const assignment = CARD_SALES_DATA[cardNumber];
            const isReserved = RESERVATION_DATA[cardNumber] !== undefined;
            
            const fileName = `tabla_${cardNumber}.png`; 
            const filePath = `./tablas/${fileName}`; 

            const assignedPlayerNameElement = document.getElementById('assignedPlayerName');
            document.getElementById('displayedCardNumber').textContent = cardNumber;

            let assignedName, messageType, displayMessage;

            if (assignment) {
                assignedName = assignment.name;
                displayMessage = `Tabla N¬∞ ${cardNumber} encontrada y asignada a ${assignedName}. ¬°Listo para descargar!`;
                messageType = 'green';
                assignedPlayerNameElement.classList.remove('text-yellow-600', 'text-red-600');
                assignedPlayerNameElement.classList.add('text-purple-600');

            } else if (isReserved) {
                // Si est√° reservada, mostramos este estado
                assignedName = 'RESERVADA (5 MIN)';
                displayMessage = `Tabla N¬∞ ${cardNumber} est√° reservada temporalmente. Intenta en unos minutos.`;
                messageType = 'yellow';
                assignedPlayerNameElement.classList.remove('text-purple-600', 'text-yellow-600');
                assignedPlayerNameElement.classList.add('text-red-600'); // Usar rojo para "no disponible"

            } else {
                assignedName = '¬°DISPONIBLE para la Venta!';
                displayMessage = `Tabla N¬∞ ${cardNumber} no est√° asignada. ¬°Puedes comprarla ahora!`;
                messageType = 'yellow';
                assignedPlayerNameElement.classList.remove('text-purple-600', 'text-red-600');
                assignedPlayerNameElement.classList.add('text-yellow-600');
            }

            assignedPlayerNameElement.textContent = assignedName;
            
            bingoCardDisplay.innerHTML = `<img src="${filePath}" alt="Tabla de Bingo N¬∞ ${cardNumber}" 
                onerror="this.onerror=null; this.src='https://placehold.co/400x400/800080/FFFFFF?text=IMAGEN%20${cardNumber}%20NO%20HALLADA%20(Error%20de%20URL%20o%20No%20Existe)'; showMessage('Advertencia: No se encontr√≥ la imagen de la Tabla N¬∞ ${cardNumber} en la carpeta /tablas/.', 'red');" 
                class="bingo-card-image w-full max-w-sm"
            />`;

            downloadLink.href = filePath;
            downloadLink.download = `OMEGA_Tabla_N${cardNumber}`;

            resultArea.classList.remove('hidden');
            showMessage(displayMessage, messageType);

            assignedPlayerNameElement.classList.add('animate-wiggle');
            setTimeout(() => {
                assignedPlayerNameElement.classList.remove('animate-wiggle');
            }, 500);
        }
        
        // =========================================================================
        // FUNCI√ìN: UTILIDADES
        // =========================================================================

        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.textContent = message;
            messageArea.className = `text-center p-4 mb-4 text-sm rounded-lg border `;
            
            switch(type) {
                case 'red':
                    messageArea.classList.add('text-red-700', 'bg-red-100', 'border-red-200');
                    break;
                case 'green':
                    messageArea.classList.add('text-green-700', 'bg-green-100', 'border-green-200');
                    break;
                case 'yellow':
                    messageArea.classList.add('text-yellow-700', 'bg-yellow-100', 'border-yellow-200');
                    break;
                case 'clear':
                    messageArea.classList.add('hidden');
                    return;
            }
            messageArea.classList.remove('hidden');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("¬°Copiado al portapapeles!"); 
            }).catch(err => {
                console.error('Error al copiar: ', err);
            });
        }
        
        function triggerConfetti() {
            const colors = ['#fcd34d', '#7e22ce', '#a855f7', '#6b21a8', '#fca311']; 

            confetti({
                particleCount: 150,
                spread: 120,
                origin: { y: 0.6 },
                colors: colors
            });
        }

        // Inicializaci√≥n al cargar la p√°gina
        window.onload = function() {
            updateAvailableCount();
            updateBingoCountdown(); 
        };

    </script>
</body>
</html>
