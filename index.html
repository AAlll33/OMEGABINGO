<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMEGA Bingo - Compra y Consulta de Tablas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <style>
        /* ESTILOS BASE: Gradiente Morado y Animaciones */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(-45deg, #7e22ce, #a855f7, #6b21a8, #8b5cf6);
            background-size: 400% 400%;
            animation: gradient-flow 15s ease infinite;
            overflow-x: hidden;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bingo-card-image {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border: 4px solid #800080;
        }

        #footer-logo { max-width: 150px; height: auto; }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            20%, 80% { transform: rotate(-0.5deg); }
            40%, 60% { transform: rotate(0.5deg); }
        }
        .animate-wiggle { animation: wiggle 0.4s ease-in-out; }
        
        .copy-btn { cursor: pointer; transition: color 0.15s; }
        .copy-btn:hover { color: #d1d5db; }

        /* ESTILOS MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto; 
        }

        /* Estilos de botones de cart√≥n */
        .card-selector-btn {
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.1s;
        }
        .card-selector-btn:hover { transform: scale(1.05); }

        /* Colores de estado del cart√≥n (Morado OMEGA) */
        .status-available {
            background-color: #6b21a8; /* Morado: Disponible */
            color: white;
            border: 2px solid #5b21b6;
        }
        .status-selected {
            background-color: #fcd34d; /* Amarillo: Seleccionado */
            color: #1f2937; 
            border: 2px solid #fbbf24;
            transform: scale(1.08);
        }
        .status-sold {
            background-color: #ef4444; /* Rojo: Vendido */
            color: white;
            opacity: 1; 
            cursor: not-allowed;
            border: 2px solid #b91c1c;
        }
        
        /* ESTILOS PARA T√çTULOS OMEGA */
        .omega-title {
            font-family: 'Poppins', sans-serif; 
            font-weight: 900; 
            font-size: 3rem; 
            line-height: 1;
            text-shadow: 
                -2px -2px 0 #5b21b6, 
                 2px -2px 0 #5b21b6, 
                -2px  2px 0 #5b21b6, 
                 2px  2px 0 #5b21b6, 
                0px   4px 0 #5b21b6, 
                0px   8px 15px rgba(0,0,0,0.4); 
            color: #fcd34d; 
            display: inline-block; 
            animation: bounce-in 1s ease-out; 
        }

        .omega-subtitle {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #fca311; 
            text-shadow: 1px 1px 0 #a855f7;
        }

        @keyframes bounce-in {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-xl mx-auto p-4 md:p-8">
        
        <div class="bg-yellow-400 p-3 rounded-t-xl text-center shadow-lg border-b-2 border-purple-800">
            <p class="font-bold text-lg text-gray-900">
                Costo de la Tabla (4 Cartas): Bs. <span id="cardCost">300,00</span>
            </p>
        </div>
        
        <div class="bg-purple-800 p-4 rounded-b-xl text-center mb-8 shadow-lg">
            <p class="text-purple-100 text-sm">Tablas Disponibles:</p>
            <p class="text-4xl font-extrabold text-white" id="availableCount">75</p>
        </div>

        <header class="text-center mb-8">
            <h1 class="omega-title">OMEGA Bingo</h1>
            <p class="omega-subtitle mt-1">Elige tus n√∫meros de tabla y paga de forma sencilla.</p>
        </header>

        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border-t-4 border-purple-600">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                Datos para Pago M√≥vil
            </h2>
            
            <div class="space-y-3">
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-gray-600 font-semibold">Banco:</span>
                    <span id="bankInfo" class="text-gray-900 font-extrabold flex items-center">
                        0108 (Provincial BBVA)
                        <svg onclick="copyToClipboard('0108')" class="copy-btn w-4 h-4 ml-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3H6zm8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-gray-600 font-semibold">C√©dula:</span>
                    <span id="idInfo" class="text-gray-900 font-extrabold flex items-center">
                        V25822059
                        <svg onclick="copyToClipboard('V25822059')" class="copy-btn w-4 h-4 ml-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3H6zm8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-gray-600 font-semibold">Tel√©fono:</span>
                    <span id="phoneInfo" class="text-gray-900 font-extrabold flex items-center">
                        04129546751
                        <svg onclick="copyToClipboard('04226431972')" class="copy-btn w-4 h-4 ml-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3H6zm8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                </div>
            </div>
            <p class="text-sm text-gray-500 mt-4 text-center">Toca el √≠cono de al lado para copiar la informaci√≥n.</p>
        </div>

        <div class="mb-10 text-center">
             <button 
                onclick="showCardSelectionModal()" 
                class="w-full px-6 py-3 bg-yellow-400 text-gray-900 font-extrabold text-xl rounded-lg hover:bg-yellow-500 transition duration-150 shadow-xl active:scale-[0.98] uppercase"
            >
                Comprar Tablas
            </button>
        </div>

        <div class="text-center mb-4">
            <h2 class="text-xl font-bold text-white drop-shadow-md">Consulta tu Tabla Asignada</h2>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border-t-4 border-purple-600">
            <h3 class="text-lg font-bold text-gray-800 mb-3">Busca tu Tabla por Tel√©fono</h3>
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="tel" 
                    id="searchPhoneInput" 
                    placeholder="Tel√©fono del Jugador (Ej: 04121234567)"
                    class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 shadow-xl"
                >
                <button 
                    onclick="searchCardByPhone()" 
                    class="w-full sm:w-auto px-6 py-3 bg-yellow-400 text-gray-900 font-semibold rounded-lg hover:bg-yellow-500 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Consultar
                </button>
            </div>
        </div>

        <div id="phoneResultArea" class="hidden bg-white/95 backdrop-blur-sm p-6 rounded-xl shadow-2xl border-t-4 border-yellow-400 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                Tablas de <span id="assignedPlayerNamePhone" class="text-purple-600 font-extrabold"></span>
            </h2>
            <div id="phoneCardsList" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mt-4">
                </div>
             <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">Para descargar, usa la secci√≥n de "Ver Tabla Individual" m√°s abajo con el n√∫mero de tabla.</p>
            </div>
        </div>


        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border-t-4 border-purple-600">
            <h3 class="text-lg font-bold text-gray-800 mb-3">Ver Tabla Individual (¬°TODAS LAS TABLAS!)</h3>
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="number" 
                    id="cardNumberInput" 
                    placeholder="N√∫mero de Tabla (Ej: 23)"
                    class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 shadow-xl"
                >
                <button 
                    onclick="searchCard()" 
                    class="w-full sm:w-auto px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Ver Tabla
                </button>
            </div>
        </div>

        <div id="messageArea" class="text-center p-4 mb-4 text-sm text-red-700 bg-red-100 border border-purple-400 rounded-lg hidden">
        </div>

        <div id="resultArea" class="hidden bg-white/95 backdrop-blur-sm p-6 rounded-xl shadow-2xl border-t-4 border-purple-600">
            <h2 class="text-xl font-bold text-gray-800 mb-2">
                Tabla N¬∞ <span id="displayedCardNumber" class="text-purple-600"></span>
            </h2>
            <p class="text-gray-700 mb-4">
                Asignado al jugador: <span id="assignedPlayerName" class="font-extrabold text-purple-600 text-lg"></span>
            </p>
            
            <div id="bingoCardDisplay" class="flex justify-center mt-4">
            </div>

            <div class="mt-6 text-center">
                <a 
                    id="downloadLink" 
                    href="#" 
                    download="Tabla_Bingo.png"
                    class="inline-block px-8 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-150 shadow-lg active:scale-[0.98]"
                >
                    Descargar Tabla
                </a>
            </div>
        </div>

        <div class="mt-12 text-center text-purple-100">
            <img 
                src="logo-bingo-omega.jpeg" 
                alt="logo bingo omega" 
                class="mx-auto rounded-xl shadow-lg"
                id="footer-logo"
            >
            <p class="mt-4 text-sm drop-shadow-md">Para mas informacion consulta al Administrador Angel +584226431972</p>
        </div>
    </div>

    <div id="cardSelectionModal" class="modal">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg shadow-2xl">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-2xl font-bold text-purple-800">Selecciona tus Tablas</h3>
                <button onclick="hideCardSelectionModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-semibold">&times;</button>
            </div>

            <div class="text-center mb-4">
                <p class="text-lg font-bold">Total a Pagar: <span id="totalCostDisplay" class="text-green-600">Bs. 0,00</span></p>
            </div>

            <div id="cardListContainer" class="max-h-80 overflow-y-auto p-2 grid grid-cols-6 gap-3 md:grid-cols-7 lg:grid-cols-8">
                </div>

            <div class="mt-6 pt-4 border-t text-center">
                 <button 
                    onclick="preparePayment()" 
                    class="w-full px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Continuar Pago
                </button>
            </div>
        </div>
    </div>

    <div id="paymentProcessModal" class="modal">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg shadow-2xl">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-2xl font-bold text-purple-800">Proceso de Pago</h3>
                <button onclick="hidePaymentProcessModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-semibold">&times;</button>
            </div>
            
            <p class="text-sm text-gray-700 mb-4 bg-yellow-100 p-2 rounded">
                *Tienes 05:00 para completar el pago y reservar tus Tablas.*
            </p>

            <div class="space-y-4">
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-gray-600 font-semibold">Total a pagar:</span>
                    <span id="paymentTotalCost" class="text-lg font-extrabold text-green-600">Bs. 0,00</span>
                </div>
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-gray-600 font-semibold">Tablas N¬∞:</span>
                    <span id="paymentCardsList" class="text-md font-bold text-purple-600 text-right"></span>
                </div>
            </div>

            <div class="mt-4 space-y-3">
                <input 
                    type="text" 
                    id="payerName" 
                    placeholder="Nombre completo" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                    required
                >
                <input 
                    type="tel" 
                    id="payerPhone" 
                    placeholder="N√∫mero de WhatsApp (Ej: 04121234567)" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                    required
                >
                <input 
                    type="text" 
                    id="referenceDigits" 
                    placeholder="√öltimos 4 d√≠gitos de la referencia de Pago M√≥vil" 
                    maxlength="4"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                    required
                >
            </div>

            <div class="mt-6 pt-4 border-t text-center">
                 <button 
                    onclick="sendPurchaseToWhatsapp()" 
                    class="w-full px-6 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-150 shadow-xl active:scale-[0.98]"
                >
                    Reservar y Enviar Pago (WhatsApp)
                </button>
            </div>
        </div>
    </div>


    <script>
        // =========================================================================
        // üîë GESTI√ìN CENTRALIZADA DE VENTAS (¬°MODIFICAR S√ìLO ESTA SECCI√ìN!)
        // =========================================================================
        /**
         * Objeto principal para gestionar las ventas y asignaciones.
         * Clave: N√∫mero de Tabla (string)
         * Valor: { name: Nombre del Jugador, phone: Tel√©fono del Jugador, file: Nombre del Archivo de Imagen }
         */
        const CARD_SALES_DATA = {
            "1": { name: "Juan P√©rez", phone: "04141234567", file: "tabla_1.png" },
            "3": { name: "sue", phone: "04220050476", file: "tabla_3.png" },
            "6": { name: "sue", phone: "04220050476", file: "tabla_6.png" },
            "9": { name: "sue", phone: "04220050476", file: "tabla_9.png" },
            "11": { name: "aa", phone: "04161647600", file: "tabla_11.png" },
            "5": { name: "Mar√≠a L√≥pez", phone: "04267654321", file: "tabla_5.png" },
            "10": { name: "Angel Admin", phone: "04226431972", file: "tabla_10.png" },
            // ... Aqu√≠ debes a√±adir el resto de tus ventas.
            "75": { name: "√öltima Tabla Vendida", phone: "04121112233", file: "tabla_75.png" }
        };
        
        // =========================================================================
        // DATOS Y VARIABLES GLOBALES
        // =========================================================================
        const TOTAL_CARDS = 75; 
        const CARD_PRICE = 300.00; 
        let selectedCards = [];
        const ADMIN_WHATSAPP = '584226431972'; // Tu n√∫mero de administrador para recibir pedidos

        // Inicializar el contador de disponibles al cargar la p√°gina
        function updateAvailableCount() {
            const soldCount = Object.keys(CARD_SALES_DATA).length;
            const availableCount = TOTAL_CARDS - soldCount;
            document.getElementById('availableCount').textContent = availableCount;
        }


        // =========================================================================
        // FUNCIONES MODAL DE SELECCI√ìN (PASO 1)
        // =========================================================================

        function showCardSelectionModal() {
            selectedCards = []; 
            updateTotalCostDisplay();
            document.getElementById('cardSelectionModal').style.display = 'flex';
            generateCardButtons();
        }

        function hideCardSelectionModal() {
            document.getElementById('cardSelectionModal').style.display = 'none';
        }

        function generateCardButtons() {
            const container = document.getElementById('cardListContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= TOTAL_CARDS; i++) {
                const isSold = CARD_SALES_DATA[i.toString()] !== undefined; // Verifica en el JSON
                const statusClass = isSold ? 'status-sold' : 'status-available';
                const button = document.createElement('div');
                
                button.className = `card-selector-btn ${statusClass} active:scale-[0.98]`;
                button.textContent = i;
                button.dataset.cardNum = i;
                button.title = isSold ? `Tabla vendida a ${CARD_SALES_DATA[i.toString()]?.name || 'Jugador Asignado'}` : `Tabla N¬∞ ${i}`;

                if (!isSold) {
                    button.onclick = () => toggleCardSelection(i, button);
                }
                
                container.appendChild(button);
            }
        }

        function toggleCardSelection(cardNum, button) {
            const index = selectedCards.indexOf(cardNum);
            
            if (index > -1) {
                selectedCards.splice(index, 1);
                button.classList.remove('status-selected');
                button.classList.add('status-available');
            } else {
                selectedCards.push(cardNum);
                button.classList.add('status-selected');
                button.classList.remove('status-available');
            }
            selectedCards.sort((a, b) => a - b);
            updateTotalCostDisplay();
        }

        function updateTotalCostDisplay() {
            const total = selectedCards.length * CARD_PRICE; 
            document.getElementById('totalCostDisplay').textContent = `Bs. ${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }
        
        // =========================================================================
        // FUNCIONES MODAL DE PAGO (PASO 2)
        // =========================================================================

        function preparePayment() {
            if (selectedCards.length === 0) {
                alert('Por favor, selecciona al menos una Tabla para continuar.');
                return;
            }
            
            hideCardSelectionModal();
            
            const total = selectedCards.length * CARD_PRICE;
            const tablesList = selectedCards.join(', ');
            const totalFormatted = total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            document.getElementById('paymentTotalCost').textContent = `Bs. ${totalFormatted}`;
            document.getElementById('paymentCardsList').textContent = tablesList;
            
            // Limpiar campos por si acaso
            document.getElementById('payerName').value = '';
            document.getElementById('payerPhone').value = '';
            document.getElementById('referenceDigits').value = '';

            document.getElementById('paymentProcessModal').style.display = 'flex';
        }
        
        function hidePaymentProcessModal() {
            document.getElementById('paymentProcessModal').style.display = 'none';
        }


        function sendPurchaseToWhatsapp() {
            const payerName = document.getElementById('payerName').value.trim();
            const payerPhone = document.getElementById('payerPhone').value.trim();
            const referenceDigits = document.getElementById('referenceDigits').value.trim();
            const totalAmount = selectedCards.length * CARD_PRICE;
            const tablesList = selectedCards.join(', ');

            if (!payerName || !payerPhone || referenceDigits.length !== 4) {
                alert('Por favor, completa tu Nombre, tu Tel√©fono de WhatsApp y los 4 d√≠gitos de la referencia del pago m√≥vil.');
                return;
            }
            
            // Mensaje final para el administrador
            const whatsappMessage = encodeURIComponent(
                `üéâ ¬°PAGO Y RESERVA OMEGA BINGO! üéâ\n\n` +
                `*Tablas:* ${selectedCards.length} (${tablesList})\n` +
                `*Monto Pagado:* Bs. ${totalAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}\n` +
                `*Nombre del Pagador:* ${payerName}\n` +
                `*Tel√©fono del Pagador:* ${payerPhone}\n` +
                `*D√≠gitos de Referencia (Pago M√≥vil):* ${referenceDigits}\n\n` +
                `_¬°Revisa y asigna las Tablas!_`
            );
            
            const whatsappLink = `https://wa.me/${ADMIN_WHATSAPP}?text=${whatsappMessage}`;

            triggerConfetti();

            setTimeout(() => {
                hidePaymentProcessModal();
                window.open(whatsappLink, '_blank');
            }, 1000); 
        }


        // =========================================================================
        // FUNCI√ìN: CONSULTA POR TEL√âFONO
        // =========================================================================

        function searchCardByPhone() {
            const phoneInput = document.getElementById('searchPhoneInput');
            const searchPhone = phoneInput.value.trim().replace(/[^0-9]/g, ''); 
            
            const phoneResultArea = document.getElementById('phoneResultArea');
            const phoneCardsList = document.getElementById('phoneCardsList');
            const assignedPlayerNamePhone = document.getElementById('assignedPlayerNamePhone');
            
            showMessage('', 'clear');
            phoneResultArea.classList.add('hidden');
            phoneCardsList.innerHTML = '';
            
            if (searchPhone.length < 10) {
                showMessage("Por favor, ingresa un n√∫mero de tel√©fono completo (m√≠n. 10 d√≠gitos).", 'red');
                return;
            }

            let foundCards = [];
            let playerName = '';

            for (const tableNum in CARD_SALES_DATA) {
                const sale = CARD_SALES_DATA[tableNum];
                const cleanSalePhone = sale.phone.replace(/[^0-9]/g, '');

                if (cleanSalePhone === searchPhone) {
                    foundCards.push({ table: tableNum, ...sale });
                    playerName = sale.name; 
                }
            }

            if (foundCards.length === 0) {
                showMessage(`El n√∫mero ${phoneInput.value} no tiene Tablas asignadas o no est√° registrado.`, 'yellow');
                return;
            }

            assignedPlayerNamePhone.textContent = playerName;
            
            foundCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'text-center p-2 border border-purple-300 rounded-lg shadow-md bg-white';
                
                // La ruta de la imagen en este caso tambi√©n asume que est√° dentro de /tablas/
                cardDiv.innerHTML = `
                    <p class="font-bold text-lg text-purple-700">Tabla ${card.table}</p>
                    <img src="./tablas/${card.file}" alt="Tabla ${card.table}" class="bingo-card-image w-full h-auto rounded-md mt-2 mx-auto"
                        onerror="this.onerror=null; this.src='https://placehold.co/150x150/800080/FFFFFF?text=TABLA%20${card.table}';"
                    />
                `;
                phoneCardsList.appendChild(cardDiv);
            });

            phoneResultArea.classList.remove('hidden');
            showMessage(`¬°Se encontraron ${foundCards.length} Tablas asignadas a ${playerName}!`, 'green');
        }


        // =========================================================================
        // FUNCI√ìN: CONSULTA POR N√öMERO DE TABLA (L√ìGICA ACTUALIZADA)
        // =========================================================================

        function searchCard() {
            const inputElement = document.getElementById('cardNumberInput');
            const rawCardNumber = inputElement.value.trim();
            const cardNumber = parseInt(rawCardNumber, 10).toString();

            showMessage('', 'clear'); 
            resultArea.classList.add('hidden');

            if (!rawCardNumber || isNaN(cardNumber) || parseInt(cardNumber) < 1 || parseInt(cardNumber) > TOTAL_CARDS) {
                showMessage("Por favor, ingresa un n√∫mero de Tabla v√°lido entre 1 y " + TOTAL_CARDS + ".", 'red');
                return;
            }

            const assignment = CARD_SALES_DATA[cardNumber];
            
            // La imagen siempre se busca aqu√≠:
            const fileName = `tabla_${cardNumber}.png`; 
            const filePath = `./tablas/${fileName}`; 

            const assignedPlayerNameElement = document.getElementById('assignedPlayerName');
            document.getElementById('displayedCardNumber').textContent = cardNumber;

            let assignedName, messageType, displayMessage;

            if (assignment) {
                // Caso 1: VENDIDA (Muestra el nombre)
                assignedName = assignment.name;
                displayMessage = `Tabla N¬∞ ${cardNumber} encontrada y asignada a ${assignedName}. ¬°Listo para descargar!`;
                messageType = 'green';
                assignedPlayerNameElement.classList.remove('text-yellow-600');
                assignedPlayerNameElement.classList.add('text-purple-600');

            } else {
                // Caso 2: DISPONIBLE (Muestra mensaje de disponibilidad)
                assignedName = '¬°DISPONIBLE para la Venta!';
                displayMessage = `Tabla N¬∞ ${cardNumber} no est√° asignada. ¬°Puedes comprarla ahora!`;
                messageType = 'yellow';
                assignedPlayerNameElement.classList.remove('text-purple-600');
                assignedPlayerNameElement.classList.add('text-yellow-600');
            }

            assignedPlayerNameElement.textContent = assignedName;
            
            // Muestra la imagen, si no la encuentra, muestra el placeholder.
            bingoCardDisplay.innerHTML = `<img src="${filePath}" alt="Tabla de Bingo N¬∞ ${cardNumber}" 
                onerror="this.onerror=null; this.src='https://placehold.co/400x400/800080/FFFFFF?text=IMAGEN%20${cardNumber}%20NO%20HALLADA%20(Error%20de%20URL%20o%20No%20Existe)'; alert('Advertencia: No se encontr√≥ la imagen de la Tabla N¬∞ ${cardNumber} en la carpeta /tablas/.');" 
                class="bingo-card-image w-full max-w-sm"
            />`;

            downloadLink.href = filePath;
            downloadLink.download = `OMEGA_Tabla_N${cardNumber}`;

            resultArea.classList.remove('hidden');
            showMessage(displayMessage, messageType);

            // Animaci√≥n para resaltar el nombre
            assignedPlayerNameElement.classList.add('animate-wiggle');
            setTimeout(() => {
                assignedPlayerNameElement.classList.remove('animate-wiggle');
            }, 500);
        }
        
        // =========================================================================
        // FUNCI√ìN: UTILIDADES
        // =========================================================================

        function showMessage(message, type) {
            messageArea.textContent = message;
            messageArea.className = `text-center p-4 mb-4 text-sm rounded-lg border `;
            
            switch(type) {
                case 'red':
                    messageArea.classList.add('text-red-700', 'bg-red-100', 'border-red-200');
                    break;
                case 'green':
                    messageArea.classList.add('text-green-700', 'bg-green-100', 'border-green-200');
                    break;
                case 'yellow':
                    messageArea.classList.add('text-yellow-700', 'bg-yellow-100', 'border-yellow-200');
                    break;
                case 'clear':
                    messageArea.classList.add('hidden');
                    return;
            }
            messageArea.classList.remove('hidden');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("¬°Copiado al portapapeles!"); 
            }).catch(err => {
                console.error('Error al copiar: ', err);
            });
        }
        
        function triggerConfetti() {
            const colors = ['#fcd34d', '#7e22ce', '#a855f7', '#6b21a8', '#fca311']; 

            confetti({
                particleCount: 150,
                spread: 120,
                origin: { y: 0.6 },
                colors: colors
            });
        }

        // Inicializaci√≥n al cargar la p√°gina
        window.onload = function() {
            updateAvailableCount();
        };

    </script>
</body>
</html>
